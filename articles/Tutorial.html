<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Integrative Bayes Model â€¢ IntegrativeBayes</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Integrative Bayes Model">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">IntegrativeBayes</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Tutorial.html">Integrative Bayes Model</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shuangj00/IntegrativeBayes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Integrative Bayes Model</h1>
                        <h4 class="author">Shuang Jiang et al</h4>
            
            <h4 class="date">2019-06-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/shuangj00/IntegrativeBayes/blob/master/vignettes/Tutorial.Rmd"><code>vignettes/Tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>Tutorial.Rmd</code></div>

    </div>

    
    
<div id="tutorial" class="section level1">
<h1 class="hasAnchor">
<a href="#tutorial" class="anchor"></a>Tutorial</h1>
<p>The following script is used to fit micribiome count data and covariate data to the integrative Bayesian zero-inflated negative binomial hierarchical mixture model proposed in our manuscript.</p>
<p>Before running the following code, please first load micribiome count data and covariate data. The necessary inputs should be</p>
<ol style="list-style-type: decimal">
<li>a n-by-p count matrix Y, where n is the number of samples and p is the number of taxa(feature)</li>
<li>a n-by-R covaritae matrix X, where R is the number of covariates</li>
<li>a n-dimensional vector z, indicating group allocation for n samples</li>
</ol>
<p>You also need to install <code>Rcpp</code>, <code>RcppArmadillo</code> and <code>pROC</code> packages.</p>
<div id="load-functions-data-matrices" class="section level2">
<h2 class="hasAnchor">
<a href="#load-functions-data-matrices" class="anchor"></a>Load functions &amp; data matrices</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(IntegrativeBayes)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#&gt; Loading required package: pROC</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt; Type 'citation("pROC")' for a citation.</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt; Attaching package: 'pROC'</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; The following objects are masked from 'package:stats':</span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt;     cov, smooth, var</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/load">load</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/Example_data.Rdata"</span>, <span class="dt">package =</span> <span class="st">"IntegrativeBayes"</span>));</a></code></pre></div>
</div>
<div id="preprocessing" class="section level2">
<h2 class="hasAnchor">
<a href="#preprocessing" class="anchor"></a>Preprocessing</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># keep the features that have at least 2 observed counts for both groups:</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">Y.input =<span class="st"> </span><span class="kw"><a href="../reference/Y.filter.html">Y.filter</a></span>(Y.mat, <span class="dt">zvec =</span> z.vec, <span class="dt">min.number =</span> <span class="dv">2</span>)[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; 300 out of 300 features are kept.</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># estimate the size factor s from the count matrix Y:</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">s.input =<span class="st"> </span><span class="kw"><a href="../reference/sizefactor.estimator.html">sizefactor.estimator</a></span>(Y.mat)</a></code></pre></div>
</div>
<div id="get-true-label-for-later-visualization" class="section level2">
<h2 class="hasAnchor">
<a href="#get-true-label-for-later-visualization" class="anchor"></a>Get true label for later visualization</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">feature.remain =<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/which">which</a></span>(<span class="kw"><a href="../reference/Y.filter.html">Y.filter</a></span>(Y.mat, <span class="dt">zvec =</span> z.vec, <span class="dt">min.number =</span> <span class="dv">2</span>)[[<span class="dv">1</span>]] <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; 300 out of 300 features are kept.</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">gamma.vec =<span class="st"> </span>gamma.vec[feature.remain]</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">delta.mat =<span class="st"> </span>delta.mat[,feature.remain]</a></code></pre></div>
</div>
<div id="implement-mcmc-algorithm" class="section level2">
<h2 class="hasAnchor">
<a href="#implement-mcmc-algorithm" class="anchor"></a>Implement MCMC algorithm</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">S.iter =<span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">burn.in =<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">mu0.start =<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">res =<span class="st"> </span><span class="kw"><a href="../reference/zinb_w_cov.html">zinb_w_cov</a></span>(<span class="dt">Y_mat =</span> Y.input,</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">                 <span class="dt">z_vec =</span> z.vec, </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">                 <span class="dt">s_vec =</span> s.input,</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">                 <span class="dt">X_mat =</span> X.mat,</a>
<a class="sourceLine" id="cb4-8" data-line-number="8">                 <span class="dt">S =</span> S.iter, <span class="dt">burn_rate =</span> burn.in,</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">                 <span class="dt">mu0_mean =</span> mu0.start)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt; 0% has been done</span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt; 10% has been done</span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt; 20% has been done</span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt; 30% has been done</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt; 40% has been done</span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt; 50% has been done</span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt; 60% has been done</span></a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="co">#&gt; 70% has been done</span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="co">#&gt; 80% has been done</span></a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="co">#&gt; 90% has been done</span></a></code></pre></div>
<p>The MCMC outputs are stored in <code>res</code>: $<code>mu0 est</code>: posterior mean(after burn-in) for the vector mu(0j) $<code>phi est</code>: posterior mean(after burn-in) for the dispersion parameter vector $<code>beta est</code>: posterior mean(after burn-in) for the Beta matrix $<code>gamma PPI</code>: PPI for all gamma(j) after burn-in $<code>delta PPI</code>: PPI for all delta(rj) fter burn-in $<code>R PPI</code>: PPI for all r(ij) after burn-in $<code>gamma sum</code>: sum of all gamma(j) for all iterations $<code>mukj full</code>: MCMC draws for mu(kj) after burn-in $<code>mu0 full</code>: MCMC draws for mu(0j) after burn-in $<code>beta full</code>: MCMC draws for beta(rj) after burn-in</p>
</div>
<div id="visualizing-the-results-for-two-variable-selection-processes" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-results-for-two-variable-selection-processes" class="anchor"></a>Visualizing the results for two variable selection processes</h2>
<div id="variable-selection-for-discriminating-features" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-selection-for-discriminating-features" class="anchor"></a>Variable selection for discriminating features</h3>
<p>The stem-plot showed the selected features passing Bayesian FDR threshold.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/gamma_VS.html">gamma_VS</a></span>(res<span class="op">$</span>gamma_PPI, <span class="dt">gamma.true =</span> gamma.vec)</a></code></pre></div>
<p><img src="Tutorial_files/figure-html/visualization-1.png" width="700"></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/par">par</a></span>(<span class="dt">mar=</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">2.1</span>))</a></code></pre></div>
</div>
<div id="variable-selection-for-significant-feature-covariate-association" class="section level3">
<h3 class="hasAnchor">
<a href="#variable-selection-for-significant-feature-covariate-association" class="anchor"></a>Variable selection for significant feature-covariate association</h3>
<p>The ROC plot was used to benchmark the performance of detecting microbiome-covariate associations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../reference/delta_ROC.html">delta_ROC</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(res<span class="op">$</span>delta_PPI), <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/MathFun">abs</a></span>(delta.mat)))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt; Setting levels: control = 0, case = 1</span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Setting direction: controls &lt; cases</span></a></code></pre></div>
<p><img src="Tutorial_files/figure-html/visualization2-1.png" width="700"></p>
</div>
</div>
</div>
<div id="citation" class="section level1">
<h1 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h1>
<p>Shuang Jiang, Guanghua Xiao, Andrew Y. Koh, Qiwei Li, Xiaowei Zhan (2018), A Bayesian Zero-Inflated Negative Binomial Regression Model for the Integrative Analysis of Microbiome Data, arXiv:1812.09654. <a href="https://arxiv.org/pdf/1812.09654">link</a>.</p>
</div>
<div id="contact" class="section level1">
<h1 class="hasAnchor">
<a href="#contact" class="anchor"></a>Contact</h1>
<p>Shuang Jiang <a href="mailto:shuangj@mail.smu.edu">shuangj@mail.smu.edu</a> Last updated on June 6, 2019. Build on 2019-06-09.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#tutorial">Tutorial</a><ul class="nav nav-pills nav-stacked">
<li><a href="#load-functions-data-matrices">Load functions &amp; data matrices</a></li>
      <li><a href="#preprocessing">Preprocessing</a></li>
      <li><a href="#get-true-label-for-later-visualization">Get true label for later visualization</a></li>
      <li><a href="#implement-mcmc-algorithm">Implement MCMC algorithm</a></li>
      <li><a href="#visualizing-the-results-for-two-variable-selection-processes">Visualizing the results for two variable selection processes</a></li>
      </ul>
</li>
      <li><a href="#citation">Citation</a></li>
      <li><a href="#contact">Contact</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Shuang Jiang, Qiwei Li, Xiaowei Zhan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
